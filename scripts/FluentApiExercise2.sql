DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'EfConventionsExercise.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201707271722439_InitialModel'
BEGIN
    CREATE TABLE [dbo].[Genres] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](max),
        CONSTRAINT [PK_dbo.Genres] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Videos] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](max),
        [ReleaseDate] [datetime] NOT NULL,
        [Classification] [int] NOT NULL,
        [Genre_Id] [int],
        CONSTRAINT [PK_dbo.Videos] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_Genre_Id] ON [dbo].[Videos]([Genre_Id])
    ALTER TABLE [dbo].[Videos] ADD CONSTRAINT [FK_dbo.Videos_dbo.Genres_Genre_Id] FOREIGN KEY ([Genre_Id]) REFERENCES [dbo].[Genres] ([Id])
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201707271722439_InitialModel', N'EfConventionsExercise.Migrations.Configuration',  0x1F8B0800000000000400ED59DB6EE336107D2FD07F10F4D41659CB4E5EDAC0DE45EA240BA39B0BA224E85B404B63872845A92415D82DFA657DE827F5173AD4CD14293B7236BB5BA0C5020B8B9C19CEE5702ECCDF7FFE357EB74A98F70442D2944FFCD160E87BC0A334A67C39F173B578F3BDFFEEEDD75F8DCFE264E5DDD774479A0E39B99CF88F4A65C74120A34748881C243412A94C176A10A54940E234381C0E7F0846A30050848FB23C6F7C93734513283EF0739AF2083295137691C6C064B58E3B6121D5BB2409C88C4430F1A748714E8554672B101195E07B278C12542404B6F03DC279AA8842358FEF24844AA47C1966B840D8ED3A03A45B10A6B90AF58F37E47D2D191E6A4B820D632D2ACAA54A933D058E8E2AD70436FB8B1CEC37AE43E79DA193D55A5B5D3870E2BF072ED072FBA4E329139AAAC3B98382E5C03B5B608C9E806B72596F1E348040DCE87F07DE34672A1730E1902B41D881779DCF198D7E82F56DFA0BF009CF193375442D71AFB5804BD722CD40A8F50D2C2ACD67B1EF056DBEC0666CD80C9ED2AC19574787BE7789879339830602860B42950A4063411005F135510A04D732A070A273BA7596FEBF3E0D3187B7C7F72EC8EA03F0A57A9CF8F8D3F7CEE90AE27AA5D2E08E53BC6CC8A4440EED43C6C1267E3BA37A4F6348F78B6AC1F27F54BF4054DD436E800191708A1AD667E9DFB7549FED18B75BD6941129E982465506A954C7C45886DCDE7F4EFC2579A2CB82D63AA8CA24A87BB12B1F69669EF350ED9F8B34B949590DD272F9214C731169635377EF968825A8BE37214FEC7B605B3893E78C2C37597FEF5BD216F8CA7706911283606B449689E976102E209983A88C0C29C36AED7BF784E5F8397242D6A27E9FB2B8A13DDC4D7BAD43891E6DE88FDC2894FE36174FA44C235AF8C60C430580F671673CF676A0C1C22A5E357421CDD06918FB89FF9DA37EB7BC1A4186BC0A8D6D79C3C160645B6858E3A65C8CBB2294370EC3437F5B9FCEF532AC5407B4B0FFA8D025AB5460EBAFC586A0CC4B257D6F83F6B6FE8EF96DF6C2095DEC953B2D76C3564B467D7B0D8A8ECB6DA7F7DDD16D94DDE819F49350C7D390503BCAAE1D6D933A324813C24D8719942D66DD8A065B7AD1F105C932BCA6466F5AAD7861D598BE09F76FD992524610C98ECEADD1B63909CB195982B56BA42E2C1C644E749E9BC689436601760B9AEAC35A9874435563AC26D7BFAB22D4DD44DA32361E3C47A312CCA8857D60C7D9E52BE602C288E8680DA629CB13BEADBDD8C55D167B93BF5C71258C034B71DB3B81E31E0BA8B6B37B85A2BA371F178A3217EC1F8A2D7C5F3A14DB24B49A2A53506BA3BF3CBBAD3045DA7B9F1F30EDBCD7819A3AA33F8B8C9AB057F875C2B6FCD491B85D6FF4424C29A30B37DA1BCDB9FBA95455A317AAB4B7329869635AB44633A95BEDA60BED63A85DCEDCC83B55CD266970D75437AB8A8DAB8AB2C7B34B5D624A12DF43DB9FD0C3585EC2B554900C34C120FC954D1945A46F082E08A70B90AA6C7FFDC3E1E8D07ABAF9F73CA30452C6ACCF5BCA671F7AA976E9B363ED9E63A339E7F22722A24722BE49C8EA5B53D247BF50FCA77DD56BEE8FF1B77ABDB9BFB07F4F499B6C64C870269B198EADAB89FF7BC174ECCD7E7EA8F90EBC2B8197FDD81B7A7FBC0C3D2F9B288D02B7DFD0E7CE1D2F194511B22034A208C36C2C71E2A76E95BF1694473423ACA5B35B8CFADC03EDBF469EBD730A19700DF096597D0EDA55751BA9D6857CCEF63DC76A7798E931356F1F9ACB3A85776BAE035B8271CBFCD839506F9FA7BB2477CFB69F70D66E596F0C4DCF4ED7EE48FE69E669B7C340C4187FFE41B04ABADC88D04D1387A885958666C617690D5A4BA39AC4CA6717A008A6557222145D9048E17604982BF5536EF5CE7596CC219EF1AB5C65B942932199B3D6D3B086FEAEF38B4783B6CEE3ABAC78207C0D13504DAA2BC315FF31A7C67BDEB99BCFB789D077AAAA813A964AD7C2E5BA917499F29E822AF735A9E016928CA13079C543F2042FD1ED4EC2075892685D378ADB853C1F88B6DBC7A7942C0549642563C38F9F88E13859BDFD07D834E01A051D0000 , N'6.1.3-40302')
END

IF @CurrentMigration < '201707271738401_FixConventions'
BEGIN
    IF object_id(N'[dbo].[FK_dbo.Videos_dbo.Genres_Genre_Id]', N'F') IS NOT NULL
        ALTER TABLE [dbo].[Videos] DROP CONSTRAINT [FK_dbo.Videos_dbo.Genres_Genre_Id]
    IF EXISTS (SELECT name FROM sys.indexes WHERE name = N'IX_Genre_Id' AND object_id = object_id(N'[dbo].[Videos]', N'U'))
        DROP INDEX [IX_Genre_Id] ON [dbo].[Videos]
    EXECUTE sp_rename @objname = N'dbo.Videos.Genre_Id', @newname = N'GenreId', @objtype = N'COLUMN'
    ALTER TABLE [dbo].[Genres] ALTER COLUMN [Name] [nvarchar](255) NOT NULL
    ALTER TABLE [dbo].[Videos] ALTER COLUMN [Name] [nvarchar](max) NOT NULL
    ALTER TABLE [dbo].[Videos] ALTER COLUMN [Classification] [tinyint] NOT NULL
    ALTER TABLE [dbo].[Videos] ALTER COLUMN [GenreId] [int] NOT NULL
    CREATE INDEX [IX_GenreId] ON [dbo].[Videos]([GenreId])
    ALTER TABLE [dbo].[Videos] ADD CONSTRAINT [FK_dbo.Videos_dbo.Genres_GenreId] FOREIGN KEY ([GenreId]) REFERENCES [dbo].[Genres] ([Id]) ON DELETE CASCADE
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201707271738401_FixConventions', N'EfConventionsExercise.Migrations.Configuration',  0x1F8B0800000000000400ED59DB6EE336107D2FD07F10F4D416592B76B0401BD8BBC83AC9C2D8CD055112F42DA0A5B14394A2549232EC16FDB23EF493FA0B1D4A942C5192633BC9F6822240609373E3CC99E10CFDE7EF7F0CDF2F23E62C40481AF391DBEF1DBA0EF0200E299F8FDC54CDDE7CEFBE7FF7F557C3B3305A3AF705DD91A6434E2E47EEA352C9B1E7C9E01122227B110D442CE399EA0571E49130F60687873F78FDBE0728C245598E33BC49B9A211645FF0EB38E601242A25EC220E8149B38E3B7E26D5B92411C884043072C748714E8554674B100195E03A278C1234C40736731DC279AC8842338FEF24F84AC47CEE27B840D8ED2A01A49B11A6B932F38FD7E4DB9EE470A04FE2AD190B51412A551CED28B07F645CE3D9EC7B39D82D5D87CE3B4327AB953E75E6C091FB11B8C093DB9A8EC74C68AA16E7F6329603E76C86315A00D7E4B2D83C280181B8D17F07CE38652A1530E2902A41D881739D4E190D3EC1EA36FE09F888A78C556D442B71AFB6804BD7224E40A8D50DCC8CE593D075BC3A9F6733966C159EFC5813AE8E06AE7389CAC9944109818A0B7C150BC0C382200AC26BA21408AE6540E6C486764B97FE5F6843CC61F6B8CE05597E063E578F2377F0F6ADEB9CD32584C58AB1E08E534C3664522285160B2DAD976441E799C196FE7B1A422C5DE70658B62D1F699267442FDB7A30A13F17717413B382235F7EB825620E0AED8F9B7B7E9C8AC0B264E8ADA1B5117099A0DD0097B1FC0FB867020E3FBE08E02CAD082F20124ED1E442B9FE7C4BA3DD658D199192CE6860AA9D394B09597B7F47F1197A9F8EC8B60966F267BFFC2A72A82DBF8ADCDB2EBFD2C8CE2EDB4D1379CEC87C7DCDED9C7B75812F9C8988BF10045B215E73233EAC104AF5185C40340561CEE85386DD89EBDC1396E2D77E236235EA8F310B4BDAC166DA6B1D497468497FD40C42EEEEEAE28994714033D754A360E25F5777C6436703182CBC63FEA20769823EC3D08FDCEF1AE6B7CB2B8BF75A9E01635D5EDFB5ABDE153FC57C56E09C0479BF3226322061332BD013617D050B25088D09C2101D12034EB96A5655CA039A10D66DB5C5B26529D62695C2ED9D534880EB2ADAEDFB6DB496F5A3A9BAD46079E929A70CBD0A7A9AF726F228E428018A86FFB23A9DEA6558AA964CC6FED624B334F5DCC68B16EB83AA1E099B847571A9E3A501B73A7BD16334D80D7C2DF6CA592D1945B1AC50B4D452DBED9BB3A934766D6723709BF3A722A170949D06F523B514EC3284EB09C6CB479862D4F13A669DE1054912AC8A95D9C7AC38BE197CDEF8BB8F04512EC30B64CB64505A5B6AC29E84CCC1DAADDC1478D99329D1D7CA388C1A6416603BD05428AB61B219AA026305B9FE6C1A87F621A525AB0DEF391E2AD20521EBB9EC3837F9B2B99330225AFABB71CCD2887717A66EEEBC63ABF2E72B4D0943CF32BC51811AEE69D4EBBAB3B70A85C99BE78522AF05BB87A283EFEF0E4597845A235C1554DBD85E9EDDC55545DA7BDB4B2DEFB0AAB8CE8BED9581D7A8913649A9BDAC95564D1C9AFAB4C3235151B07212D741072D106958ACFC955410F53441CFFF998D19C5F3AE092E08A733902AEF5DDDC1617F603D34FD731E7D3C2943B6CDCBCF179F83A976E99393EE8E935D75F4E50B228247229AAF2D1B85EEF880F1DFF5DB3711597EFB12CF00217E562FF70C8093D92A73C2F3A6FE4C44A36F9E60F3BE1CB9BF663CC7CEE4C707C376E05C09CCFD63E7D0F96D4F04ED371F9A86F88B8E705637BCCF40BAD714D8D5ACBDCEE0F72F99F59A1DF616A35CF724975F779895531DD71CC41D434DEB94D73DE4B5496E1FB85E7100AC9DBED2C93F39F235E7C4D719F29A8D0A22A6F29B176255D2F95A84FE058C4350C34A4933E1B3B8C0AC6551416255C10B50040B3239118ACE48A0703B00ACB2FA91D83C769D45530827FC2A5549AAF0C8104D59EDD159437F93FE6C92ADDB3CBC4AB247C29738029A49F59D72C53FA4B4F2A877DE528A3B44E89C32D7A78EA5D2D7E87C554ABA8CF996828CFBCA52700B51C25098BCE23E59C03EB6DD49F80C7312AC8A7EB35BC8D381A8BB7D784AC95C90481A196B7EFC8A180EA3E5BBBF00DDEC687EFA1D0000 , N'6.1.3-40302')
END

IF @CurrentMigration < '201707271753190_AddManyToManyVideosTagsTables'
BEGIN
    CREATE TABLE [dbo].[Tags] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](255) NOT NULL,
        CONSTRAINT [PK_dbo.Tags] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[VideoTags] (
        [VideoId] [int] NOT NULL,
        [TagId] [int] NOT NULL,
        CONSTRAINT [PK_dbo.VideoTags] PRIMARY KEY ([VideoId], [TagId])
    )
    CREATE INDEX [IX_VideoId] ON [dbo].[VideoTags]([VideoId])
    CREATE INDEX [IX_TagId] ON [dbo].[VideoTags]([TagId])
    ALTER TABLE [dbo].[VideoTags] ADD CONSTRAINT [FK_dbo.VideoTags_dbo.Videos_VideoId] FOREIGN KEY ([VideoId]) REFERENCES [dbo].[Videos] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[VideoTags] ADD CONSTRAINT [FK_dbo.VideoTags_dbo.Tags_TagId] FOREIGN KEY ([TagId]) REFERENCES [dbo].[Tags] ([Id]) ON DELETE CASCADE
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201707271753190_AddManyToManyVideosTagsTables', N'EfConventionsExercise.Migrations.Configuration',  0x1F8B0800000000000400ED5A6D6FDB3610FE3E60FF41D0A76D48ADBCA0C016D82D52272982362F88D362DF0A5A3A3BC4284A13A9C0DEB05FB60FFB49FB0B3BEACD1249D992E3A46B5114286292773CDE3D7747DEE9DFBFFF19BE5E84CC798044D0888FDC83C1BEEB00F7A380F2F9C84DE5ECC5CFEEEB57DF7F373C0BC285F3B15C77A4D621251723F75ECAF8D8F3847F0F21118390FA4924A2991CF851E89120F20EF7F77FF10E0E3C40162EF2729CE16DCA250D21FB813FC711F7219629619751004C14E33833C9B83A57240411131F46EED90C573F00D2475C9C2D20F1A900D7396194A030136033D7219C4792A815C71F044C6412F1F924C601C2EE9631E0BA19618A2A3BC2F16A79D7D3EC1FAAD3782BC292959F0A19853D191E1C15EAF174F2AD94EC56EA43059EA1A2E4529D3A53E2C87D0B3CC193EB3B1D8F59A256B528789091ED39D6C9BD0A18881FF56FCF19A74CA6098C38A432216CCFB949A78CFAEF607917FD067CC453C6EA72A2A438D718C0A19B248A2191CB5B9815D25F04AEE335E93C9DB022ABD1E447BBE0F2E8D075AE7073326550C1A0A686898C12C0C34242240437444A48B8E20199228DDDB5BDD4FFE56E883BF422D7B9248BF7C0E7F27EE41EBE7CE93AE7740141395248F08153743A2492490A1609B55DAFC8039D67026BFB7FA40144C2756E8165D3E29EC6B9570CB2A94F85F9CF9328BC8D5849910F7FBA23C91C24CA1F997393284D7C4D92A1B782D75AD0658CFA832E23FB06BA47820EFFDC09E8B45D116240049CA2C8E5E6EAEF3B1AF6E7356644083AA37E11F58AB354B0D5E77BB2CF10BCD9225D9DACF0A1ED7CACF4239B8F95FED755903B325FE7EBF9B42E861A6D91229BB209D1D9D191437F3747A26F4EFEC567963568B3E7950610BBA12D0DF5A4A247860B71CE906F75BCAD524E93E98EB189160920614BB4602EC89B2546D0A6152E219C42529C7342195ED05DE7236129FE3C306CD658FD366241B5F670FDDA1B654A546AB5FEC83444AEF2FAE08910914F33D5D42D5184BDE676673C70D6C4402DCC23A2518334469DA1F947EE4F86F8767E15BE56FC8A18DCE477E0EA71E09A9F621A93E09CF8F9757D4C844F02D32F50134173044307240A1384213A041A9C7269C619CA7D1A13D62EB546D2313829912AE6FACC29C4C0555C69D77D975DABB4696E5DEDA069699352865E0D3D5D40954595F5186826B44743AA19B156ECB2D4B69659EBE1F270860A91A88ECAFB70BB3F96A753350C0B690955F8762DA29528C2B72EB9623B0159B717C6E055F46C3A8371F0267919E10DF242911BC8F3F86F10676AD3486B6AD2B62FEF4EB51596AB950EC7F551A61274754403D0EBE34A8D43A9633D3C348FD4F9B8B9D2DA4E6B827F13FCB7396B03F03506B96C9D0F5A66ED0AE6AB2A8E979771CA728FD752EF195E9238C6B458ABFF1423CE242FFE8C5F4CFA9744C29C87E70B4B65A492B6DA09AF69640EDA2C6E8D929ED344487CE4902951778B71101ACB34A76E719972B386DF9A762A5DA95CAEFECE49D614692CA1BDA03FC783852A2B6457511DD4265D567F238C24966BEF386269C8DBB3533B757E91ADD3E7232687A1A7096EA421434546D26E2ABC93390AC779BC39F2B8D9DF1C2D749FDB1C6D1C1A85803AA3C644777EFA95BECE529FEBCEB5BACCD4D9B5DE703E1BF85A427E5FE8A9ACDB1F7856AACF0DBBA7364433A159424191A43B797BB1D6EAD116EDAA5C6C7B673792BAA9914EF6C818D96FEFB55D7B09D4FA62E92410B2E8278E7ED930CD67DC39F4251578AABB8776C71816F97E73E3C9B800E44B5C07657F401D61F29F2C858470A0160C26BFB331A30892D5824BC2E90C84CC8B01EEE1FEC1A1D6B8FAFF34913C2102D6A593F4ECA536AA54BAB198D6B3425CAFAEF10792F8F72431EB6B6B99F66C867CBD7AFB21248B1F77D14E08F06FB9BB7682A47C9929E171DD838C85F156BFE0012C46EE9F19CDB173F1EBA7826CCFB94ED0F78F9D7DE7AF5D21C8C8245F157E9ED4EFB6545D7B3235D75AF3DC664D575BF4835941D60366E6D685C4FD36CE887680EEEDCAC9459DE8592BBE5AE1649B62E35645E3B667FDD3D489BFA8D2B0F58EDCDF504F0993AC00AA0BB0B998FCA80EC3B381C5FECEEC133F9F192FB6274CCD62BAB12C76FA8AB0D2D57ACF8994D657E2CE7162EFCA9875DE96BA4DF36390B69E4BFE48C4BBEC5485A13C39B6F410ACFD98F6768C8DB3BDE66F6BD5B4756A6C5CAD8D00ABB476C6ABA95699AD5B3C5D9BA861B45A097C63B3C4ECB0ECB41554F571D675845AEA42FD456D893FB6BAD54E0F59F69AD61ED25E6BD243B556BC7C8E03F6E87399B5250C57B54F9F31520A3A5FB1501F4273F01B81AA5A73C16751192E3589CA25DAB5FE1224C137343949249D115FE2B40FF830569F0E151F7C9C8553082EF8752AE354E291219CB2C6A7482AEEAEDB3F6BE635651E5EC759657417474031A92A035CF33729AD7DD8726E795FB4B05001BD78B12A5B4AF5729D2F2B4E5711EFC8A8505F9587EE208C193213D77C421E601BD93E08780F73E22FCB12613B93CD8668AA7D784AC93C21A12878ACE8F12762380817AFFE0376C940C001300000 , N'6.1.3-40302')
END

