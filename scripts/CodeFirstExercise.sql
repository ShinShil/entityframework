DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'CodeFirstExercise.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201707271116176_InitialModel'
BEGIN
    CREATE TABLE [dbo].[Genres] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](max),
        CONSTRAINT [PK_dbo.Genres] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Videos] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](max),
        [ReleaseDate] [datetime] NOT NULL,
        CONSTRAINT [PK_dbo.Videos] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[VideoGenres] (
        [Video_Id] [int] NOT NULL,
        [Genre_Id] [int] NOT NULL,
        CONSTRAINT [PK_dbo.VideoGenres] PRIMARY KEY ([Video_Id], [Genre_Id])
    )
    CREATE INDEX [IX_Video_Id] ON [dbo].[VideoGenres]([Video_Id])
    CREATE INDEX [IX_Genre_Id] ON [dbo].[VideoGenres]([Genre_Id])
    ALTER TABLE [dbo].[VideoGenres] ADD CONSTRAINT [FK_dbo.VideoGenres_dbo.Videos_Video_Id] FOREIGN KEY ([Video_Id]) REFERENCES [dbo].[Videos] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[VideoGenres] ADD CONSTRAINT [FK_dbo.VideoGenres_dbo.Genres_Genre_Id] FOREIGN KEY ([Genre_Id]) REFERENCES [dbo].[Genres] ([Id]) ON DELETE CASCADE
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201707271116176_InitialModel', N'CodeFirstExercise.Migrations.Configuration',  0x1F8B0800000000000400ED59CD6EE33610BE17E83B083AB545D64AB2976D60EF22759222E8260EE224E82DA0A5B14394A254920AEC2DFA643DF491FA0A1DEA5FA46449E9222DDA22406093F33F1F8733F41FBFFD3EFDB00D99F30C42D288CFDCA3C9A1EB00F7A380F2CDCC4DD4FACD3BF7C3FB2FBF989E07E1D67928E8DE6A3AE4E472E63E29159F789EF49F20247212525F44325AAB891F851E0922EFF8F0F05BEFE8C80314E1A22CC799DE265CD110D22FF8751E711F629510761505C064BE8E3BCB54AA734D429031F161E6CE91E2820AA9CEB7207C2AC1754E192568C812D8DA7508E791220ACD3CB997B05422E29B658C0B84DDED6240BA35619A2B35FFA4221FEAC9E1B1F6C4AB180B517E2255148E1478F4360F8D67B2BF28C06E193A0CDE390659EDB4D7690067EEF7C0057A6E6A3A9933A1A95A823B49590E1C6BE3A004036246FF214DC2542260C6215182B003E7265931EAFF00BBBBE827E0339E3056B70F2DC4BDC6022EDD882806A176B7B0CEADBE0C5CC76BF2792663C956E3C95CBAE4EAEDB1EB5CA372B26250A6BFE6FE524502D05110444170439402C1B50C480368693774E9FF8536C41B9E1CD7B922DB8FC037EA69E6E247D7B9A05B088A95DC827B4EF1A021931209584AAEC933DDA4F619EA1E680091749D5B60E9B67CA27106FE49BAF598A60C092E4414DE46AC60C9D71FEF88D8804283A396CD659408DF3066EA5540DA0BAF54D23878A52CFFC3EBF5E165284130019170861616BAF4E73BAA755BCE0D856A81C49742B540632B540B1C0F81EAA994914F531BEA582DF437DD39E781B3CF982C13A513980D44268D118BA879E67E63C5A7436079102B817981DE2B70EAD5BCB1CF23DEA58A50045BE5E8A7DDD94A2FC356B59C4EBC25F3032A73AC98D66BB14B504652AB48378DB79C6FB217E5CB62CF8369B0D77C356494E0A991B481CBAC003DE92DEDAD4CF5068A28125A1351D8681698A65B2D082ED358F5425ED60C154D93D7D1354DAF481C6395A87551F98AB3CC5BA837CBF1CD4598C9F07CD9D26394D6969AB0E6910D18BBB51B00AB0B59115D4CE641689119A0ED4054A1AC814B3B5705CE0A72FD3963E968774C1955042FD0A910CB76EA1F9879B6F9D20E9630225AEE8F79C4929077DD41FBB8B31BA1CE9FADD812A69E61B8191DCF0A8F015433D88352911F9CBF968AAC1E8C4F4507DFDF9D8A2E098D9BB72EA8B1F1FAA96D56A896FC96F5B7378925656BAA5A8F8E2EB16D7DAF51ADEDA80CCA7126AA2DD33A2AA5E29136E5E5FF8536A54246DA64DE237622ADEBC4242961545E2BC6F531CD4BF988C9BCA8ED1989EBA0EDCF1828ACEBCB9D54104E34C164F9339B338AC0AD08AE08A76B902A6BE85DBC7ADE19D3FD3F67D2F6A40CD89071FBD54712AA43DA3B74F435F57BA610FE4C84FF44C45721D97E5D97644F1A2367C7FF74AC064D65017E56FD53D9B8B8BF18A87B0AA94DDC55E1FAF355A9A965CD1A642E7900DB99FB4BCA74E25CFEF858F01D380B81E5E5C439747E1D9DCDCAEC71CA0BBE11CA5F36BEB65E86E68CD23FB71E5977F0829F21001538A77E5665E744FA24B023A62FA8BDDAF3D1D03461C8B8AB5F8B610D429F45C2F01E934AE04D66B53B3782729FC68435BCB62FE3211544BB54CA3377CE2006AE4B83EDE0106DFB7A8F52B411DEBE00743E09F400A7AD63A9A5CECE5A6BC2FE65C0199ECAD705CEBE06F1B303A7FD2DC99EDE073C1575BF1465FD21DE692B5D9EB2AAD8F160D2FA8AD4FD88D426B9FD35A75D7297E1F5CD4E1D1D2EF4BE64954F50FB1FB43A661FBBE05B3371EF4356C36D73421BFE8635C8D9E2B1ACC7D9F6A1CA2E52D65BCC6B393BE2C1CE9EA4F084D67E09C50A21E9A612A17F17E5E037CE664973C9D75151240C8B0A12A391B90245B07D24A742D135F1156EFB2065FA83C2036109929C872B082EF9225171A2D0650857ACF103852E35FBF4A7AF924D9BA78B387DFBFF1C2EA0995477C00BFE5D425950DA7DD1D24B7588D0352CEFF5752E95EEF937BB52D275C4070ACAC35796DE3B086386C2E4822FC933BCC4B67B091F6143FC5D3110770BE94F4433ECD3334A368284329751F1E357C470106EDFFF09B142AD4910200000 , N'6.1.3-40302')
END

IF @CurrentMigration < '201707271122524_RemoveManyToManyBetweenVideosAndGenresTables'
BEGIN
    IF object_id(N'[dbo].[FK_dbo.VideoGenres_dbo.Videos_Video_Id]', N'F') IS NOT NULL
        ALTER TABLE [dbo].[VideoGenres] DROP CONSTRAINT [FK_dbo.VideoGenres_dbo.Videos_Video_Id]
    IF object_id(N'[dbo].[FK_dbo.VideoGenres_dbo.Genres_Genre_Id]', N'F') IS NOT NULL
        ALTER TABLE [dbo].[VideoGenres] DROP CONSTRAINT [FK_dbo.VideoGenres_dbo.Genres_Genre_Id]
    IF EXISTS (SELECT name FROM sys.indexes WHERE name = N'IX_Video_Id' AND object_id = object_id(N'[dbo].[VideoGenres]', N'U'))
        DROP INDEX [IX_Video_Id] ON [dbo].[VideoGenres]
    IF EXISTS (SELECT name FROM sys.indexes WHERE name = N'IX_Genre_Id' AND object_id = object_id(N'[dbo].[VideoGenres]', N'U'))
        DROP INDEX [IX_Genre_Id] ON [dbo].[VideoGenres]
    DROP TABLE [dbo].[VideoGenres]
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201707271122524_RemoveManyToManyBetweenVideosAndGenresTables', N'CodeFirstExercise.Migrations.Configuration',  0x1F8B0800000000000400ED585B6FDB36147E2FB0FF20F06903523397972E905B64765204AD932072F34E4BC70E319252492AB0FBD7FAB09FB4BFB043DD2F966BA745566043804022CFF9CEFD22FFFDF52FFFDD5A0AEF09B4E1B11A9393D131F1408571C4D56A4C52BB7CFD86BC7BFBCB2BFF32926BEFA1A43B7374C8A9CC983C5A9B9C536AC24790CC8C240F756CE2A51D85B1A42C8AE9E9F1F1EFF4E484024210C4F23CFF3E55964BC85EF07512AB10129B32318B2310A638C79B2043F56E980493B010C6648214575C1B7BB9061D7203C4BB109CA122018825F19852B16516D53CFF6420B03A56AB20C10326E69B04906EC984E3CAD43FAFC9F7B5E4F8D459426BC6122A4C8D8DE581802767856B6897FD590E2695EBD07997E864BB7156670E1C93F7A0345ADE95743E11DA516D71EE286339F27A1747553260CEB83FA449854D358C15A4563371E4DDA50BC1C30FB099C77F821AAB5488A67EA821DEB50EF0E84EC70968BBB98765A1F575443CDAE6A35DC68AADC1939B74ADECD929F16E50385B08A8C2DF303FB0B106341434B310DD316B412B870199037BD23BB2DCFF521AE61B560EF1666CFD11D4CA3E8E093E12EF8AAF212A4F0A0D3E298E85864C56A7D016E2D33A763B23FAC023880F8B68C6F27F445F38A27D21F720801998A286A52CF73CE74E76CFB8FDB3039BA9651C4DAF53E4CB66BA70C7B0B65B7205DB64912EA6D0BCAD770E1B806D761143BC5A89BCF78E8AF64277B367F9B78DBDC8E56D965636D59381E6A3A11C21746086F833962418C0C64C294EBCA01828AF83C35BADCC316868B674DC4ADB4A12A6235B41E7B6519C1878B6602ECE9348F6C83A111C706F29AC15A46E2DD64E2FC9DD73CE32D0FCBB18B507AFD028891595D9079522E59CE9F165F39C09A6B794F62416A95443ED6117775EAC4DFEFCA48FE0D38EE25DEFD09E7B3A4DAAEBECBD425124FCF785222F8EC34331C0F76F876208A1D5149B40AD8B170E6DAF0B75492AE95537EA741DBFE80007ACB7654BC84988878E7AC258623B0836C6821C398251F0594C04477B6B8219537C09C6E6239AE08A79DA59917F9E75951A13897D76D6175F32B873E937D7889D637AF75EA19E980E1F99FE55B2F56F4DA4EFDE06FFD3BEDA6BCF8AF0D9FEE83DAB3FCCF758A386B7A8BCEE51D705EE44F35CC772F3DA67C31A5EB0B621974BD93397AF7E7BF369F31BDF9F82E1AB1AC27DF12B085DDFA8414B9A6BB58CCB18A2514D8D4A924E88676019C6945D68CB972CB4781D8231D9DEFEC0448A24977201D1B5BA4D6D92DA0B63402E44EB3BC0A7BBE5671B665B67FF36716FE64798806A729796B7EA8F948BA8D2FB6A4B5A0E40B8042C0A10B5C2EF16845B6D2AA49B58ED0954B86F0A092857BE739089403073AB02F604CFD10DBF313EC28A859B724A0D837C3B106DB7FB53CE569A495360D4FCEE772BEA7EB87AFB0F0D566765EA120000 , N'6.1.3-40302')
END

IF @CurrentMigration < '201707271124172_AddGenreColumnToVideosTable'
BEGIN
    ALTER TABLE [dbo].[Videos] ADD [Genre_Id] [int]
    CREATE INDEX [IX_Genre_Id] ON [dbo].[Videos]([Genre_Id])
    ALTER TABLE [dbo].[Videos] ADD CONSTRAINT [FK_dbo.Videos_dbo.Genres_Genre_Id] FOREIGN KEY ([Genre_Id]) REFERENCES [dbo].[Genres] ([Id])
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201707271124172_AddGenreColumnToVideosTable', N'CodeFirstExercise.Migrations.Configuration',  0x1F8B0800000000000400ED59DB6EE336107D2FD07F10F4D416592BC9BEB486BD8BD4490AA39B0BA224E85B404B63872845AA2415D85BF4CBFAD04FEA2F74A89B2552B6656F372DD02240E0903367AE9C8BF3E7EF7F8CDE2F13E6BD805454F0B17F3238F63DE09188295F8CFD4CCFDF7CEBBF7FF7E517A38B38597A8F15DD5B43879C5C8DFD67ADD36110A8E81912A206098DA45062AE07914802128BE0F4F8F8BBE0E4240084F011CBF3467719D73481FC0FFC73227804A9CE08BB123130559EE34D98A37AD72401959208C6FE04292EA954FA620932A20A7CEF8C51828A84C0E6BE4738179A685473F8A020D452F04598E20161F7AB14906E4E98E1CAD51FAEC9FB5A727C6A2C09D68C155494292D923D014FDE96AE096CF6831CECD7AE43E75DA093F5CA589D3B70ECFF005CA2E5B6A4E1844943D5E1DC41CE72E4391747753260CE981FA4C998CE248C39645A1276E4DD663346A31F61752F7E063EE619634DFD5043BC6B1DE0D1AD142948BDBA8379A9F534F6BDA0CD17D88C355B83A73069CAF5DB53DFBB46E164C6A00E7FC3FC500B09682848A221BE255A83E4060372073AD22D59E677250DF30D5F8EEF5D91E507E00BFD3CF6F1A3EF5DD225C4D549A9C103A7F8D09049CB0CDA4246C13A765B23FA486310FB453467F93FA2AF1C5157C81D30200ACE51C34A96F97C4F8D6CC7380BEB9ABCD0456EAB855A3E7104CF6FD5334D8BCA58C4FDA9BCBF9422B913ACCAA0E2F82914998C8C36C2BDBB277201BA5F9A9E2925229A2BD0CCD35278DB920B1E7B5B34296250EB8F71C09CA4296621CA1DFBDF389EE9C6ABB46FE0959E68E31D0F0627B68D0D6BDCB788AD4B138A89B636F4E3EA7C668E61A93B5E2636A5F271AA324F6CFD0D6C08BA1950E57B6B4FB7F577CC6FB3E74EE8622FDD69B1376CB530AACC6950742496FDF6B747B75676AD67D00FA18A6703A172945D58DA2675646F1DC2F5D811147347359F041B0694D1154953AC0E8D81A53CF1C2725A7913EEDFC79302238854473BAFB5AD2561AD230BB06E1B951FAB0A991153442671E2905909BB219B2A61AD9C744355E558456E3E172C1B260B1B63EDC14B342AC1729DDB07769C5DBE7C58248CC88EBE31112C4BF8A6DEB38DBBE8044DFEE2C445180596E2B67702C73D56A2DACEEE158AF2DD7C5A288A5AB07F2836F0FDD3A1D884D0EAB84DA0D6C5EB87B65DA13AE25BD5DE9D31AC087B05CA9456CB431D25D6F546AFD816185D1136DEA8E5EEA752D9370E54696F65B026C6341F62A6CA0C64F530D6C750BBF1B89177FA8F4D52E75DDD87AC7E332A6BFF1E5B73D50C0A12DF43DB5FD0C3D808C295D2900C0CC120FC854D18C54C5F135C114EE7A07431F9FBB8B99E5A9BF7BF670B0E948A599F55F8D577176A5CBA733BD935FD6F5957F80B91D133915F2564F97513E99397CCFFB4AF7AAD6F317ED6BDD6B7AEA5EDC9B2DCD91CA63C86E5D8FF35671A7AD39F9E2ABE23EF46E2131D7AC7DE6F87C5FCB08DADD196F65BAADCB9FE90550F130DA4C903C2B0862A2DB18A3ABDF916D7F788A684B574765B489FEC35FEABF1EC9B7348819BB46C99D547D0B65E59A35ACF6897ED7BAEADEEB2D0632BDDBC9416DD055FC4CC04B648C60DFB59E7C2BA795FED42EEDE1D3FE32EDBB2BEB194ECDC5EDD95F7F3ECABEE5C8019D3F8CE1D9355D1C51AC28C3A1CA256AED434533E1755D25A1A5524563DBB024DB0189233A9E99C441AAF23502AFF1EED91B00C492E9219C4537E93E934D368322433D6FA5ECEA4FE36F9F952DED6797493E6DF79FD1D26A09AD4D4F31BFE7D46595CEB7DE9D6F34D10E64D959DCBC4529B0EB658D548D782F7042ADD5797827B48528660EA8687E4050ED1ED41C107589068558D779B417607A2EDF6D139250B49125562ACF9CDFF9102F38FA4777F018D7BF0167A1A0000 , N'6.1.3-40302')
END

IF @CurrentMigration < '201707271714500_AddClassficationColumnToVideosTable'
BEGIN
    ALTER TABLE [dbo].[Videos] ADD [Classification] [int] NOT NULL DEFAULT 0
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201707271714500_AddClassficationColumnToVideosTable', N'CodeFirstExercise.Migrations.Configuration',  0x1F8B0800000000000400ED59DB6EE336107D2FD07F10F4D41659CB4E5EDAC0DE45EA240BA39B0BA224E85B404B63872845A92415D85BF4CBFAD04FEA2F74A89B295276E46C765BA0C5020B8B9C19CEE5702ECC5F7FFC397EB74A98F70442D2944FFCD160E87BC0A334A67C39F173B578F3BDFFEEEDD75F8DCFE264E5DDD774479A0E39B99CF88F4A65C74120A34748881C243412A94C176A10A54940E234381C0E7F0846A30050848FB23C6F7C93734513283EF0739AF2083295137691C6C064B58E3B6121D5BB2409C88C4430F1A748714E8554672B101195E07B278C12542404B6F03DC279AA8842358FEF24844AA47C1966B840D8ED3A03A45B10A6B90AF58F37E47D2D191E6A4B820D632D2ACAA54A933D058E8E2AD70436FB8B1CEC37AE43E79DA193D55A5B5D3870E2BF072ED072FBA4E329139AAAC3B98382E5C073360E1A302066F43FA4C999CA054C38E44A1076E05DE77346A39F607D9BFE027CC273C64CFD5043DC6B2DE0D2B54833106A7D038B4AEB59EC7B419B2FB0191B3683A73469C6D5D1A1EF5DE2E164CEA009BF617EA85201682808A220BE264A81E05A06140E744EB7CED2FFD7A721DEF0E6F8DE05597D00BE548F131F7FFADE395D415CAF541ADC718A170D9994C8A17DC838D8C46E6744EF690CE97E112D58FE8FE8178EA87BC80D3020124E51C3FA2CFDFB96EAB31DE376CB9A3222255DD0A8CA1C95EA9810CB70DBFBCF89BF244F7459D05A07551904752F76E523CDCC731EAAFD7391263729AB015A2E3F84692E226D6CEAEEDD12B104D5F716E4897D076C0B67F29C91E526DBEF7D43DA025FF1BE204A62106C8DA832F1DC0EC0052473109581216558A17DEF9EB01C3F474EB85AD4EF531637B487BB69AF7518D19B0DFD911B81D2D7E6E2899469440BBF9821A882DF3EEE8CC7DE0E245838C56B862EA4193A0DE33EF1BF73D4EF9657A3C7905721B12D6F38188C6C0B0D6BDC548B9D892294370EC3433FAE4FE77A1956AA0356D87354C892551AB0F5D7624350E68592BEB7417A5B7FC7FC367BE1842EF6CA9D16BB61AB25A3BEB90645C7C5B653FBEEE836CA6EF40CFA49A8E36948A81D65D78DB6491DD9A309E1A6AB0CCAB6B26E3F832DFDE7F88264195E53A31FAD56BCB06A46DF84FBB769492923886447B7D668DB9C84A58C2CC1DA35D216160D32273AC74DE3C421B300BB054DF5612D4CBAA1AA315693EBDF5501EA6E1C6D191B0F9EA3510956E3C23EB0E3ECF215B300614474B405D394E509DFD65AECE22E0BBDC95FAEB812C681A5B8ED9DC0718F0554DBD9BD4251DD9B4F0B45990BF60FC516BE7F3A14DB24B41A2A53506BA3BF3CBBA53045DA7B5F1E30EDBCD7819A3AA33F8B8C9AB057F875C2B6FCD491B85D6FF4424C29A30B37DA1BCDB9FBA95455A317AAB4B7329869635AB44633A9DBECA603ED63A85DCEDCC83B55CD266970D75437AB8A8DAB8AB2C7534B5D624A12DF43DB9FD0C3585EC2B554900C34C120FC954D1945A46F082E08A70B90AA6C7FFDC3E1E8D07AAEF9F73C9D0452C6ACCFFBC9171F78A976E9B323ED9E23A339E3F22722A24722BE49C8EA5B53D227BF4CFCA77DD56BE68FF1B77ABD99BFB07F4F499B6C64C870269B198EADAB89FF5BC174ECCD7E7EA8F90EBC2B8197FDD81B7ABFBF0C3D2F9B288D02B7DFD0E7CE1D2F194511B22034A208C36C2C71E2A76E95BF1694473423ACA5B35B8CFADC03EDBF469EBD730A19700DF096597D0EDA55751BA9D6857CCEF63DC76A7798E931356F1F9ACB3A85776BAE035B8271CBFCD839506F9FA7BB2477CFB69F71D66E596F0C4DCF4ED7EE48FE79E669B7C340C4187FF241B04ABADC88D04D1387A885958666C617690D5A4BA39AC4CA6717A008A6557222145D9048E17604982BF5336EF5CE7596CC219EF1AB5C65B942932199B3D6B3B086FEAEF38B4783B6CEE3ABAC78137D0D13504DAA2BC315FF31A7C67BDEB99BCFB789D077AAAA813A964AD7C2E5BA917499F29E822AF735A9E016928CA13079C543F2042FD1ED4EC2075892685D378ADB853C1F88B6DBC7A7942C0549642563C38F9F88E13859BDFD1BD3EB1133F91C0000 , N'6.1.3-40302')
END

